<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mana Reports - Frontend</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto;max-width:900px;margin:30px auto;padding:20px;}
    label{display:block;margin-top:10px;font-weight:600}
    input,select,button{padding:8px;margin-top:6px;width:100%;box-sizing:border-box}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    table{width:100%;border-collapse:collapse;margin-top:16px}
    th,td{border:1px solid #ddd;padding:8px;text-align:left}
    th{background:#f4f4f4}
    .hidden{display:none}
    .notice{background:#eef;padding:10px;border:1px solid #cce;margin-top:12px}
  </style>
</head>
<body>
  <h1>DPO/MPO ‚Äî Frontend</h1>
  <p>DPO/MPO ‡∞§‡±ã ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç ‡∞ö‡±á‡∞∏‡∞ø ‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡±ç ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø.</p>

  <div id="loginBox">
    <label>User id (DPO/MPO)</label>
    <input id="uid" placeholder="‡∞â‡∞¶‡∞æ‡∞π‡∞∞‡∞£: DPO.../MPO...." />

   <div class="row">
  <div>
    <label>District (‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ)</label>
    <select id="district">
      <option value="">-- ‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>
      <option value="Adilabad">Adilabad</option>
      <option value="Bhadradri Kothagudem">Bhadradri Kothagudem</option>
      <option value="Hyderabad">Hyderabad</option>
      <option value="Jagtial">Jagtial</option>
      <option value="Jangaon">Jangaon</option>
      <option value="Jayashankar Bhupalpally">Jayashankar Bhupalpally</option>
      <option value="Jogulamba Gadwal">Jogulamba Gadwal</option>
      <option value="Kamareddy">Kamareddy</option>
      <option value="Karimnagar">Karimnagar</option>
      <option value="Khammam">Khammam</option>
      <option value="Komaram Bheem Asifabad">Komaram Bheem Asifabad</option>
      <option value="Mahabubabad">Mahabubabad</option>
      <option value="Mahabubnagar">Mahabubnagar</option>
      <option value="Mancherial">Mancherial</option>
      <option value="Medak">Medak</option>
      <option value="Medchal-Malkajgiri">Medchal-Malkajgiri</option>
      <option value="Mulugu">Mulugu</option>
      <option value="Nagarkurnool">Nagarkurnool</option>
      <option value="Nalgonda">Nalgonda</option>
      <option value="Narayanpet">Narayanpet</option>
      <option value="Nirmal">Nirmal</option>
      <option value="Nizamabad">Nizamabad</option>
      <option value="Peddapalli">Peddapalli</option>
      <option value="Rajanna Sircilla">Rajanna Sircilla</option>
      <option value="Ranga Reddy">Ranga Reddy</option>
      <option value="Sangareddy">Sangareddy</option>
      <option value="Siddipet">Siddipet</option>
      <option value="Suryapet">Suryapet</option>
      <option value="Vikarabad">Vikarabad</option>
      <option value="Wanaparthy">Wanaparthy</option>
      <option value="Warangal Urban">Warangal Urban</option>
      <option value="Warangal Rural">Warangal Rural</option>
      <option value="Yadadri Bhuvanagiri">Yadadri Bhuvanagiri</option>
    </select>
  </div>

  <div>
    <label>Mandal (‡∞Æ‡∞Ç‡∞°‡∞≤‡±ç)</label>
    <select id="mandalSelect">
      <option value="">-- ‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å‡∞ó‡∞æ ‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>
    </select>
  </div>
</div>
<script>
  // Telangana District (‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ)s ‡∞ï‡∞ø sample Mandal (‡∞Æ‡∞Ç‡∞°‡∞≤‡±ç)s
  const mandalsByDistrict (‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ) = {
    "Hyderabad": ["Secunderabad", "Charminar", "Gachibowli", "Shamirpet"],
    "Khammam": ["Khammam Urban", "Palair", "Yellandu"],
    "Warangal Urban": ["Hanamkonda", "Kazipet", "Warangal"],
    "Warangal Rural": ["Wardhannapet", "Narsampet", "Parvathagiri"],
    "Karimnagar": ["Karimnagar Urban", "Huzurabad", "Choppadandi"],
    "Nizamabad": ["Nizamabad", "Bheemgal", "Yellareddy"],
    "Adilabad": ["Adilabad Urban", "Gudihatnoor", "Mavala"]
    // üëâ ‡∞Æ‡∞ø‡∞ó‡∞§‡∞æ ‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ‡∞≤‡∞ï‡±Å ‡∞ï‡±Ç‡∞°‡∞æ ‡∞Æ‡±Ä‡∞∞‡±Å Mandal (‡∞Æ‡∞Ç‡∞°‡∞≤‡±ç) names ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞æ‡∞≤‡∞ø
  };

  const districtEl = document.getElementById('district');
  const mandalEl = document.getElementById('mandalSelect');

  districtEl.addEventListener('change', () => {
    const d = districtEl.value;
    mandalEl.innerHTML = '';
    if (!d) {
      mandalEl.innerHTML = '<option value="">-- ‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å‡∞ó‡∞æ ‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>';
      return;
    }
    const mandals = mandalsByDistrict (‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ)[d] || [];
    if (mandals.length === 0) {
      mandalEl.innerHTML = '<option value="">-- Mandal (‡∞Æ‡∞Ç‡∞°‡∞≤‡±ç)s ‡∞≤‡∞≠‡±ç‡∞Ø‡∞Ç ‡∞ï‡∞æ‡∞µ‡±Å --</option>';
      return;
    }
    mandalEl.innerHTML = '<option value="">-- ‡∞Æ‡∞Ç‡∞°‡∞≤‡∞Ç ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>';
    mandals.forEach(m => {
      const o = document.createElement('option');
      o.value = m;
      o.textContent = m;
      mandalEl.appendChild(o);
    });
  });
</script>


    <button id="btnLogin" style="margin-top:12px">Login / Fetch Report</button>
    <div id="msg" class="notice hidden"></div>
  </div>

  <div id="reportArea" class="hidden">
    <h2>Report for <span id="rid"></span></h2>
    <p><strong>District (‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ):</strong> <span id="rdistrict"></span> &nbsp; <strong>Mandal (‡∞Æ‡∞Ç‡∞°‡∞≤‡±ç):</strong> <span id="rmandal"></span></p>

    <table id="tbl">
      <thead>
        <tr><th>#</th><th>Name</th><th>Status</th><th>Time</th><th>Date</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <button id="btnBack" style="margin-top:12px">Back</button>
  </div>

  <script>
    const btn = document.getElementById('btnLogin');
    const msg = document.getElementById('msg');
    const reportArea = document.getElementById('reportArea');
    const loginBox = document.getElementById('loginBox');

    btn.addEventListener('click', async () => {
      const uid = document.getElementById('uid').value.trim();
      const district = document.getElementById('district').value;
      // use mandalSelect id (fixed)
      const mandal = document.getElementById('mandalSelect').value.trim();

      if (!uid) { showMsg('‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø DPO/MPO ‡∞™‡±Ü‡∞ü‡±ç‡∞ü‡∞Ç‡∞°‡∞ø'); return; }
      if (!district) { showMsg('‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø District (‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ) ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø'); return; }

      showMsg('Loading...');

      // ===== REPLACE WITH YOUR RENDER URL =====
const apiUrl = `https://manareports-demo.onrender.com/api/report?uid=${encodeURIComponent(uid)}&district=${encodeURIComponent(district)}&mandal=${encodeURIComponent(mandal)}`;

      try {
        const resp = await fetch(apiUrl);
        if (resp.ok) {
          const data = await resp.json();
          showReport(uid, district, mandal, data);
          return;
        } else {
          console.error('API error', resp.status);
        }
      } catch (e) { console.error('Fetch error', e); }

      // fallback mock
      const mock = {
        date: new Date().toLocaleDateString(),
        time: new Date().toLocaleTimeString(),
        rows: [
          { name: 'Raja', status: 'Present', time: '09:02 AM', date: '2025-09-12' },
          { name: 'Sita', status: 'Absent', time: '-', date: '2025-09-12' },
          { name: 'Krishna', status: 'Present', time: '09:05 AM', date: '2025-09-12' }
        ]
      };
      showReport(uid, district, mandal, mock);
    });

    function showMsg(t) {
      msg.textContent = t; msg.classList.remove('hidden');
    }

    function showReport(uid, district, mandal, data) {
      loginBox.classList.add('hidden'); reportArea.classList.remove('hidden');
      document.getElementById('rid').textContent = uid;
      document.getElementById('rdistrict').textContent = district;
      document.getElementById('rmandal').textContent = mandal || '-';
      const tbody = document.querySelector('#tbl tbody'); tbody.innerHTML = '';
      (data.rows || []).forEach((r,i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i+1}</td><td>${escapeHtml(r.name)}</td><td>${escapeHtml(r.status)}</td><td>${escapeHtml(r.time||'-')}</td><td>${escapeHtml(r.date||'')}</td>`;
        tbody.appendChild(tr);
      });
      msg.classList.add('hidden');
    }

    document.getElementById('btnBack').addEventListener('click', () => {
      reportArea.classList.add('hidden'); loginBox.classList.remove('hidden'); msg.classList.add('hidden');
    });

    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
  </script>
</body>
</html>
